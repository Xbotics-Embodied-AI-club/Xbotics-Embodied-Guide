### 6.1 Isaac Lab

#### 1、Isaac Sim 入门

##### 1.1 安装

###### 系统安装要求

[https://docs.omniverse.nvidia.com/platform/latest/common/technical-requirements.html](https://docs.omniverse.nvidia.com/platform/latest/common/technical-requirements.html)



###### 【omniverse】的下载与安装

下载[https://developer.nvidia.cn/omniverse](https://developer.nvidia.cn/omniverse)，需要邮箱注册。




之后点击该网站[https://docs.omniverse.nvidia.com/install-guide/latest/index.html](https://docs.omniverse.nvidia.com/install-guide/latest/index.html)

选择你的安装方式[https://docs.omniverse.nvidia.com/install-guide/latest/workstation-install.html](https://docs.omniverse.nvidia.com/install-guide/latest/workstation-install.html)
- 下载 omniverse launcher
- linux 安装方法: 
  - 给权限，命令行 ./xxxx
  - 或者不用命令行，右键APPImage -> permissions -> allow execution as file
- 注册账户yanaibo1214@gmail.com

<img width="554" height="132" alt="image" src="https://github.com/user-attachments/assets/f7af056e-a545-40dd-9de5-a254a376517a" />


###### 【Isaac Sim】的安装

官网 [https://developer.nvidia.com/isaac/sim](https://developer.nvidia.com/isaac/sim)
 
<img width="554" height="296" alt="image" src="https://github.com/user-attachments/assets/7a9c847c-4cf0-4e5e-8567-4b043b26b466" />

###### prerequisite 系统要求

<img width="553" height="468" alt="image" src="https://github.com/user-attachments/assets/c1ee2d2f-8ef1-4903-bea6-10f4b73b179b" />


###### 安装 Isaac sim
- 点击 exchange 交易所，找到 isaac sim

<img width="554" height="327" alt="image" src="https://github.com/user-attachments/assets/36dd62c7-59be-469b-86fb-41387876ccfa" />

- 版本选择 2023.1.1 或者 2023.1.0

- 安装 cache

<img width="553" height="327" alt="image" src="https://github.com/user-attachments/assets/b60c636a-5814-46bd-92ba-db0d29eb7896" />

- 安装完毕之后，进入 Nucleus 注册账户

<img width="553" height="326" alt="image" src="https://github.com/user-attachments/assets/0420a89e-228e-4fa3-a76f-5a0df784522e" />

- 点击 设置 。必须有 Cache 出来才算装上了，并且都是 RUNNING 状态
假如 Cache 是 Stop 状态，就换一个版本 2023.1.0  去图书馆卸载 Cache 再重新安装

<img width="554" height="533" alt="image" src="https://github.com/user-attachments/assets/1cd37149-cb18-4e6d-a331-8300d51a0400" />

- 同时点击文件夹，可以打开浏览器看到文件内容

<img width="553" height="325" alt="image" src="https://github.com/user-attachments/assets/9afedb3c-725c-467d-867a-80389a334f62" />


###### GR00T

[https://developer.nvidia.com/project-GR00T?ncid=so-yout-261862-vt48 ](https://developer.nvidia.com/project-GR00T?ncid=so-yout-261862-vt48 )




##### 1.2 基本操作教程

###### 基本结构

<img width="554" height="97" alt="image" src="https://github.com/user-attachments/assets/94bcc8aa-dbac-4510-955f-9340dc8a39b8" />

###### menu bar 工具栏

<img width="78" height="378" alt="image" src="https://github.com/user-attachments/assets/537407e9-725c-4c7c-972a-0f838394d3cc" />

1 是选择 2 是移动 3 是旋转。 搭配使用：先选择物体，再拖动它。快捷键 QWER。WW按两下会显示自身坐标系，按一下就是世界坐标系

项目栏：这里可以打开代码
时间戳：window->extensions
时间戳是一个扩展程序，允许开发人员查看和修改可滚动和可自定义时间线的设置。默认情况下，时间线处于禁用状态，要启用它，请转到窗口 > 扩展，在搜索栏中输入omni.anim.window.timeline，然后单击切换按钮。然后，在屏幕底部，会出现时间线小部件。当您按下“播放”按钮时，时间线标记开始移动，并在时间线上循环。模拟的开始/停止进度也可以在默认布局底部的时间线上查看。

###### helloworld 入门
启动 Isaac Sim launcher，加载了一个地板

<img width="552" height="302" alt="image" src="https://github.com/user-attachments/assets/6b708c67-473c-4be7-825b-a399c621706a" />

<img width="553" height="418" alt="image" src="https://github.com/user-attachments/assets/fb92324a-6085-420f-af4b-12b8a7d85845" />

退出当前项目：点击 File，点击 New，dont save 即可。

###### 机械臂 demo 

<img width="554" height="299" alt="image" src="https://github.com/user-attachments/assets/b6f18784-98ad-4091-9e21-187593720262" />

<img width="552" height="291" alt="image" src="https://github.com/user-attachments/assets/99cd9a40-624e-4ace-aff6-d4930881011d" />

- 抓取：右侧的 stage 场景中点击 target cube，将它拖到任意一个机械臂可能到达的地方，点击左侧 Task Controls 中的 Follow Target 按钮的 start，机械臂就开始运动了。

- 堆码垛 demo：manuplation simple stack。

- 机器人种类：UR10 Franka jetbot realsense 等。

- extensions 创建

<img width="554" height="847" alt="image" src="https://github.com/user-attachments/assets/3de623f3-db43-45cb-bd1e-3511cb9ee33f" />

<img width="554" height="349" alt="image" src="https://github.com/user-attachments/assets/924dfe1b-b0a4-4f47-95ec-1e704db522fd" />

Configuration Tooling Template 配置工具类；
Loaded Scenario template 办公室等场景的模版；
Scripting Template 脚本模版，例如工厂流水线式工作，第一步、第二步、第三步固定；
UI Component Library 仪表等需要人看着操作的

<img width="554" height="438" alt="image" src="https://github.com/user-attachments/assets/af0f30af-dfec-4a4e-b4fb-56f05f9ddc79" />

打开扩展编辑页面。

见【图6-1，6-2，6-3】(详见 files/images/第六节.md)

添加你自己创建的 extensions，添加完成之后点击自己的 extensions，可以查看信息
<img width="554" height="342" alt="image" src="https://github.com/user-attachments/assets/8cae57c8-7f2b-4bde-8fee-171fcd2bc528" />

同时，在任务栏也会出现一个条目 title，点击它的下拉菜单，加载扩展（extension）
<img width="553" height="189" alt="image" src="https://github.com/user-attachments/assets/36fe24a8-3164-476e-84b9-de1befe2bde0" />

-standalone 应用-python 创建：
意思就是用 python 脚本来启动 isaac sim，不是用 gui。好处是不占用资源，因为界面渲染会占据大量资源。这个方式适合强化学习。
先关闭 isaac sim

###### 强化学习

<img width="553" height="48" alt="image" src="https://github.com/user-attachments/assets/848dc061-0fa5-4b3c-9c2b-291fb01dec7e" />

<img width="554" height="391" alt="image" src="https://github.com/user-attachments/assets/b7d7d861-2356-4b52-8257-49aad8ecb66f" />

这个案例是让小车靠近小球。

###### 普通应用

```Shell
cd /home/yab/.local/share/ov/pkg/isaac-sim-2023.1.1
```

```Shell
./python.sh standalone_examples/api/omni.isaac.franka/follow_target_with_rmpflow.py
```

执行之后等待一下，

<img width="554" height="361" alt="image" src="https://github.com/user-attachments/assets/4886e780-ca32-43ed-bcf8-b40af78246df" />

或者

```Shell
./python.sh standalone_examples/api/omni.isaac.core/add_cubes.py
```


###### stage 配置

设置全局场景属性及物理属性：

<img width="554" height="391" alt="image" src="https://github.com/user-attachments/assets/8ca19faf-716b-4dd9-b711-a04960bab965" />
<img width="554" height="970" alt="image" src="https://github.com/user-attachments/assets/8450ba7d-a188-43da-a07d-98707595f345" />

添加地面：

<img width="554" height="970" alt="image" src="https://github.com/user-attachments/assets/96eadb61-6df5-463c-a4fe-87e6bad6b050" />
<img width="553" height="422" alt="image" src="https://github.com/user-attachments/assets/b0d86ea9-f59b-4805-affb-31c2013e6b5c" />

添加灯光：

<img width="553" height="397" alt="image" src="https://github.com/user-attachments/assets/0e63dd55-883d-4cb9-96a2-81d5816e81ef" />

###### 制作一个简易小车入门

添加和抓取形状，并给物体添加物理属性：(刚体，碰撞体，预设属性)

<img width="554" height="305" alt="image" src="https://github.com/user-attachments/assets/fec64f34-5e15-4aa2-b7fd-765b79ab296b" />


如果添加了，那么开始仿真之后，它就会像真实世界中的物体倒地。

<img width="554" height="446" alt="image" src="https://github.com/user-attachments/assets/4c715f73-5ca4-4aaf-b503-3df69bd2ff4c" />

如果 enable 取消勾选，物体就不会倒地。（测试碰撞属性同上）

<img width="554" height="353" alt="image" src="https://github.com/user-attachments/assets/77c49919-f17d-4431-80d9-1762cdc9d11e" />


编辑物理属性比如摩擦力：

<img width="517" height="931" alt="image" src="https://github.com/user-attachments/assets/ed305eb8-f00f-4d5b-abb6-21cdce28c35b" />

<img width="554" height="544" alt="image" src="https://github.com/user-attachments/assets/c3bf7613-ca0f-4180-8ef3-c9dcf2d2da10" />

编辑物理属性比如颜色和反射率：

首先选择你要改变的物体，再点击颜色设置

<img width="554" height="805" alt="image" src="https://github.com/user-attachments/assets/d3c499db-2f05-4cf8-bf36-820a225fdeac" />

再选中车体，选择 material：

<img width="553" height="369" alt="image" src="https://github.com/user-attachments/assets/2b2bd375-2155-4b5f-8651-ea7b27de906f" />

建立图元 prim：

<img width="554" height="392" alt="image" src="https://github.com/user-attachments/assets/4122fca8-659f-452e-b8c8-0cf693923071" />

<img width="554" height="654" alt="image" src="https://github.com/user-attachments/assets/0b07a58e-9d3b-4e85-9c9c-10257af0fefd" />

添加关节：
- 选中 body 和 left wheel，然后 create 一个 revolute joint
- 此时会出现一个绿色的圆圈，调整它的 axis，使得圆圈的朝向和轮子旋转的方向一致即可
- 点击开始仿真按钮，按住 shift 按键，单击车子任意部位，即可拖动它运动

<img width="517" height="827" alt="image" src="https://github.com/user-attachments/assets/c256563a-1818-4952-b856-d3a529331171" />

添加驱动：
- 同时选中两个关节，添加角度驱动器

<img width="554" height="579" alt="image" src="https://github.com/user-attachments/assets/7577c2b6-716d-4383-9266-32110f127354" />

- 位置控制：对于位置控制关节，设置高刚度和相对低或零阻尼。
- 速度控制：对于速度控制器关节，设置高阻尼和零刚度。
对于车轮上的关节，速度控制更有意义，因此将两个车轮的阻尼设置为1e4*，并将目标速度设置为200。如果您使用的关节范围有限，则可以在“属性”选项卡的“原始 USD 属性”>“下限（上限）”下进行设置。按下“播放”即可看到模拟移动机器人启动。

添加关节根：

<img width="525" height="806" alt="image" src="https://github.com/user-attachments/assets/18050bfb-ca3b-41bc-93c0-dbd0db892c5f" />

添加相机和传感器:

<img width="553" height="348" alt="image" src="https://github.com/user-attachments/assets/d596f142-e013-4be2-ace8-64812a981d39" />

添加激光雷达:

[https://docs.omniverse.nvidia.com/isaacsim/latest/advanced_tutorials/tutorial_advanced_range_sensor_lidar.html#isaac-sim-app-tutorial-advanced-range-sensor-lidar](https://docs.omniverse.nvidia.com/isaacsim/latest/advanced_tutorials/tutorial_advanced_range_sensor_lidar.html#isaac-sim-app-tutorial-advanced-range-sensor-lidar)

更复杂的机器人:

[https://docs.omniverse.nvidia.com/isaacsim/latest/advanced_tutorials/tutorial_advanced_rigging_robot.html#isaac-sim-app-tutorial-advanced-rigging-robot](https://docs.omniverse.nvidia.com/isaacsim/latest/advanced_tutorials/tutorial_advanced_rigging_robot.html#isaac-sim-app-tutorial-advanced-rigging-robot)

<img width="554" height="223" alt="image" src="https://github.com/user-attachments/assets/37ef5874-df69-453a-b0ec-c2f6be8269ec" />

###### 调用外部 python 编译器

通过调用外部的编辑器来操作 isaac sim，或者通过 WINDOW EXTENSIONS

<img width="554" height="466" alt="image" src="https://github.com/user-attachments/assets/f9ff95f9-45c8-4c2d-9cdd-7ef2eb42d9c0" />

- 打开一个新的 terminal，输入 telnet localhost 8223
- 输入代码，回车
仅在空的 Stage 运行Isaac Sim Core API，并且只运行一次。

原始 USD API 功能多样且详细，但很复杂，尤其是对于初学者来说。Isaac Sim 有一组核心 API，可简化机器人模拟器的一些常用操作。这些 API 抽象了默认参数设置。（设置舞台，添加具有物理和碰撞预设的长方体，设置物理和视觉材料属性）


```python
import numpy as np
from omni.isaac.core.objects import DynamicCuboid
from omni.isaac.core.objects.ground_plane import GroundPlane
from omni.isaac.core.physics_context import PhysicsContext
PhysicsContext()
GroundPlane(prim_path="/World/groundPlane", size=10, color=np.array([0.5, 0.5, 0.5]))
DynamicCuboid(prim_path="/World/cube",
    position=np.array([-.5, -.2, 1.0]),
    scale=np.array([.5, .5, .5]),
    color=np.array([.2,.3,0.]))
```

###### 编辑器使用

Isaac Sim VS Code Edition：

先要在 vscode 中安装插件。在 4.0.0 中快速打开 vscode 的方法是在扩展管理中使能扩展插件，如下

<img width="452" height="510" alt="image" src="https://github.com/user-attachments/assets/c79e4034-6bfe-4e82-afb0-fd211aa2d3f3" />

在更早的版本，则打开 Isaac Sim App Selector

<img width="553" height="506" alt="image" src="https://github.com/user-attachments/assets/a89c2b16-cd27-4458-815e-0ca921717f99" />

详情见链接[https://docs.omniverse.nvidia.com/isaacsim/latest/reference_material/reference_user_interface.html#isaac-sim-app-selector](https://docs.omniverse.nvidia.com/isaacsim/latest/reference_material/reference_user_interface.html#isaac-sim-app-selector)
点击

<img width="554" height="657" alt="image" src="https://github.com/user-attachments/assets/89c0ef10-0c41-4ebe-b9e4-087a5284e47f" />

创建一个空的 python 脚本，输入代码，点击左侧的运行按钮，得到一个球体

<img width="554" height="661" alt="image" src="https://github.com/user-attachments/assets/abf6ed14-06b6-4c8c-ad4b-e4d99c7a8de4" />

<img width="552" height="343" alt="image" src="https://github.com/user-attachments/assets/40338c83-1504-4f66-9c6a-a2fd118cd342" />

更多细节可以参考[https://marketplace.visualstudio.com/items?itemName=NVIDIA.isaacsim-vscode-edition](https://marketplace.visualstudio.com/items?itemName=NVIDIA.isaacsim-vscode-edition)

在 vscode 中debug 用 python 文件：

- 打开 Isaac Sim App Selector

详情见链接[https://docs.omniverse.nvidia.com/isaacsim/latest/reference_material/reference_user_interface.html#isaac-sim-app-selector](https://docs.omniverse.nvidia.com/isaacsim/latest/reference_material/reference_user_interface.html#isaac-sim-app-selector)

<img width="554" height="535" alt="image" src="https://github.com/user-attachments/assets/346c8b14-a4fc-4c21-888d-ddd87c04d15a" />

- vscode 中要先安装 isaac 插件 Isaac Sim VS Code Edition
- 打开之后，我们测试一个 demo，文件目录如下，加一个断点。

<img width="554" height="657" alt="image" src="https://github.com/user-attachments/assets/e6b0d1e3-0453-40e0-958a-344df1a6da02" />

- 点击左侧的 run and debug 按钮，点击 debug 即可。或者按 F5 也可以

<img width="554" height="621" alt="image" src="https://github.com/user-attachments/assets/fdb8612a-f631-41f4-b22a-e8f5ba0e8a32" />

- 传参数
更改一下 launch.json 和 python 文件

```Shell
{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Python: Current File",
            "type": "python",
            "request": "launch",
            "program": "
${file}",
            "console": "integratedTerminal",
            "env": {
                "EXP_PATH": "$
{workspaceFolder}/apps",
                "RESOURCE_NAME": "IsaacSim"
            },
            "python": "
${workspaceFolder}/kit/python/bin/python3",
            "envFile": "$
{workspaceFolder}/.vscode/.standalone_examples.env",
            "preLaunchTask": "setup_python_env",
            "args": ["--/persistent/isaac/asset_root/default=\"omniverse://my_server\""]
        }
        ,
        {
            "name": "Python: Current File",
            "type": "python",
            "request": "launch",
            "program": "
${file}",
            "console": "integratedTerminal",
            "env": {
                "RESOURCE_NAME": "IsaacSim"
            },
            "python": "$
{workspaceFolder}/kit/python/bin/python3",
            "envFile": "
${workspaceFolder}/.vscode/.standalone_examples.env",
            "preLaunchTask": "setup_python_env"
        },
        {
            "name": "Python: Attach (windows-x86_64/linux-x86_64)",
            "type": "python",
            "request": "attach",
            "port": 3000,
            "host": "localhost"
        },
        {
            "name": "(Linux) isaac-sim",
            "type": "cppdbg",
            "request": "launch",
            "program": "$
{workspaceFolder}/kit/kit",
            "args": ["
${workspaceFolder}/apps/omni.isaac.sim.kit",
                "--ext-folder", "$
{workspaceFolder}/exts",
                "--ext-folder", "
${workspaceFolder}/apps"],
            "stopAtEntry": false,
            "cwd": "$
{workspaceFolder}",
            "environment": [],
            "externalConsole": false,
            "MIMode": "gdb",
            "setupCommands": [
                {
                    "description": "Enable pretty-printing for gdb",
                    "text": "-enable-pretty-printing",
                    "ignoreFailures": true
                }
            ]
        }
    ]
}
```

```python
Copyright (c) 2020-2023, NVIDIA CORPORATION. All rights reserved.
NVIDIA CORPORATION and its licensors retain all intellectual property
and proprietary rights in and to this software, related documentation
and any modifications thereto. Any use, reproduction, disclosure or
distribution of this software and related documentation without an express
license agreement from NVIDIA CORPORATION is strictly prohibited.
import omni
from omni.isaac.kit import SimulationApp
# The most basic usage for creating a simulation app
kit = SimulationApp()
for i in range(100):
kit.update()
omni.kit.app.get_app().print_and_log("Hello World!")
kit.close()  # Cleanup application
The most basic usage for creating a simulation app
kit = SimulationApp()
import carb
server_check = carb.settings.get_settings().get_as_string("/persistent/isaac/asset_root/default")
print(server_check)
for i in range(100):
    kit.update()
kit.close()  # Cleanup application
```

<img width="554" height="282" alt="image" src="https://github.com/user-attachments/assets/4219cfbd-ec58-43b4-a8e1-67b9d84e9c6d" />

debug 在 isaac sim 中跑的应用和 vscode 交互
- 运行 isaac sim
-  在 isaac sim 顶部工具栏的窗口，扩展中搜索 omni.kit.debug.vscode，使能它，然后可以看到一行红字“VS Code Debugger Unattached”

<img width="553" height="227" alt="image" src="https://github.com/user-attachments/assets/8fe14b19-9537-46c8-a94e-656172f4e9b2" />

- 运行你刚刚的 vscode，点击 debug 的按钮旁边的下拉菜单

<img width="554" height="566" alt="image" src="https://github.com/user-attachments/assets/f3a9dc09-692e-4120-a79f-1074b34f04c8" />

这时候红色字变蓝色了
- 上一步能成功，原因在于 vscode 和 isaac sim 之间配置了相同的 ip 和端口

<img width="396" height="277" alt="image" src="https://github.com/user-attachments/assets/b69fdfc3-9652-4e4e-857d-9d59846f2bc3" />

想要更改参数，在 app selector 中添加即可

```Shell
--/exts/omni.kit.debug.python/host="127.0.0.1"
--/exts/omni.kit.debug.python/port=3000
```

```Shell
    {
        "name": "Python: Attach (windows-x86_64/linux-x86_64)",
        "type": "python",
        "request": "attach",
        "port": 3000,
        "host": "127.0.0.1"
    },
```
- 点击 isaac sim 中的 Break，那么断点就会在 vscode 中出现

###### 核心 API


工具栏选择 hello world，点击 containning folder，你就可以看到这个例子包含的代码文件

<img width="554" height="335" alt="image" src="https://github.com/user-attachments/assets/c149f395-e2c2-415f-9b73-74931d15d671" />

<img width="554" height="335" alt="image" src="https://github.com/user-attachments/assets/aa8d049c-1c8a-475d-9d66-8540abe85b92" />


打开 hello_world.py,重写代码

```python
Copyright (c) 2020-2023, NVIDIA CORPORATION. All rights reserved.
NVIDIA CORPORATION and its licensors retain all intellectual property
and proprietary rights in and to this software, related documentation
and any modifications thereto. Any use, reproduction, disclosure or
distribution of this software and related documentation without an express
license agreement from NVIDIA CORPORATION is strictly prohibited.
from omni.isaac.examples.base_sample import BaseSample
import numpy as np
Can be used to create a new cube or to point to an already existing cube in stage.
from omni.isaac.core.objects import DynamicCuboid
Note: checkout the required tutorials at https://docs.omniverse.nvidia.com/app_isaacsim/app_isaacsim/overview.html
class HelloWorld(BaseSample):
    def 
__init__
(self) -> None:
        super().
__init__
()
        return
    def setup_scene(self):
        world = self.get_world()
        world.scene.add_default_ground_plane()
        fancy_cube = world.scene.add(
            DynamicCuboid(
                prim_path="/World/random_cube", # The prim path of the cube in the USD stage
                name="fancy_cube", # The unique name used to retrieve the object from the scene later on
                position=np.array([0, 0, 1.0]), # Using the current stage units which is in meters by default.
                scale=np.array([0.5015, 0.5015, 0.5015]), # most arguments accept mainly numpy arrays.
                color=np.array([0, 0, 1.0]), # RGB channels, going from 0-1
            ))
        return
    async def setup_post_load(self):
        return
    async def setup_pre_reset(self):
        return
    async def setup_post_reset(self):
        return
    def world_cleanup(self):
        return
```

重新开一个 stage，点击 load hello world
添加打印信息，可以在 terminal 中显示

```Shell
from omni.isaac.examples.base_sample import BaseSample
import numpy as np
from omni.isaac.core.objects import DynamicCuboid
class HelloWorld(BaseSample):
    def 
__init__
(self) -> None:
        super().
__init__
()
        return
    def setup_scene(self):
        world = self.get_world()
        world.scene.add_default_ground_plane()
        fancy_cube = world.scene.add(
            DynamicCuboid(
                prim_path="/World/random_cube",
                name="fancy_cube",
                position=np.array([0, 0, 1.0]),
                scale=np.array([0.5015, 0.5015, 0.5015]),
                color=np.array([0, 0, 1.0]),
            ))
        return
    async def setup_post_load(self):
        self._world = self.get_world()
        self._cube = self._world.scene.get_object("fancy_cube")
        self._world.add_physics_callback("sim_step", callback_fn=self.print_cube_info) #callback names have to be unique
        return
    # here we define the physics callback to be called before each physics step, all physics callbacks must take
    # step_size as an argument
    def print_cube_info(self, step_size):
        position, orientation = self._cube.get_world_pose()
        linear_velocity = self._cube.get_linear_velocity()
        # will be shown on terminal
        print("Cube position is : " + str(position))
        print("Cube's orientation is : " + str(orientation))
        print("Cube's linear velocity is : " + str(linear_velocity))
```

[https://docs.omniverse.nvidia.com/isaacsim/latest/core_api_tutorials/tutorial_core_hello_world.html](https://docs.omniverse.nvidia.com/isaacsim/latest/core_api_tutorials/tutorial_core_hello_world.html)

##### 1.3 ROS和ROS2

###### ROS1
参考文档：[https://docs.omniverse.nvidia.com/isaacsim/latest/ros_tutorials/tutorial_ros_turtlebot.html
turtlebot3](https://docs.omniverse.nvidia.com/isaacsim/latest/ros_tutorials/tutorial_ros_turtlebot.html
turtlebot3) 链接：[https://emanual.robotis.com/docs/en/platform/turtlebot3/overview/](https://emanual.robotis.com/docs/en/platform/turtlebot3/overview/)

导入 turtlebot3_burger，
进入 isaac sim 的工作空间。

```Plain Text
git clone -b noetic-devel https://github.com/ROBOTIS-GIT/turtlebot3.git turtlebot3
```

```Plain Text
rosrun xacro xacro -o turtlebot3_burger.urdf turtlebot3_burger.urdf.xacro
```

<img width="553" height="297" alt="image" src="https://github.com/user-attachments/assets/f47a4efb-cfb0-4459-96f3-6017df3a5dde" />

<img width="553" height="297" alt="image" src="https://github.com/user-attachments/assets/98c7f31c-fd39-4b2c-9a06-fffe4d4900c4" />


<img width="554" height="324" alt="image" src="https://github.com/user-attachments/assets/9ed1af7a-b813-4cc1-8716-4bb534749573" />

发送速度指令。

```Plain Text
rostopic pub /cmd_vel geometry_msgs/Twist '{linear:  {x: 0.2, y: 0.0, z: 0.0}, angular: {x: 0.0,y: 0.0,z: 0.0}}'
```

```Plain Text
rostopic pub /cmd_vel geometry_msgs/Twist '{linear:  {x: 0.0, y: 0.0, z: 0.0}, angular: {x: 0.0,y: 0.0,z: 0.0}}'
```

```Plain Text
rosrun teleop_twist_keyboard teleop_twist_keyboard.py
```

添加单线激光：发布 odom，先运行 roscore，再启动 isaac 模拟仿真。roscore 只要启动一次就可以了。不需要关掉。

<img width="525" height="388" alt="image" src="https://github.com/user-attachments/assets/453d466c-a279-4f93-b2a6-17d714494461" />

<img width="546" height="130" alt="image" src="https://github.com/user-attachments/assets/650300d0-ac55-424c-8aeb-404839846330" />

发布 odom->base_link，
发布其他传感器的 link。

<img width="554" height="490" alt="image" src="https://github.com/user-attachments/assets/841ff31e-f066-4568-9326-7ccce57d2ddb" />

<img width="531" height="346" alt="image" src="https://github.com/user-attachments/assets/e9f0348c-f14f-4e40-b6cd-6f1bdde1fd06" />

如果只写 targetPrims，那么生成的 tf 是 world->base_scan。

本案例中，两者都要填写。base_footprint 不填写，它会报错。

<img width="531" height="346" alt="image" src="https://github.com/user-attachments/assets/a62fa1fe-5432-4724-9f67-865ff59d55cc" />
<img width="539" height="272" alt="image" src="https://github.com/user-attachments/assets/c7e862db-1a3d-4b9c-a25e-b44f91f0438c" />

###### 导航--以 carter_warehouse 为例
[https://github.com/isaac-sim/IsaacSim-ros_workspaces](https://github.com/isaac-sim/IsaacSim-ros_workspaces)

- 单线激光雷达

<img width="325" height="233" alt="image" src="https://github.com/user-attachments/assets/1e642928-e54a-4572-aa93-3a97cddf2533" />

<img width="552" height="181" alt="image" src="https://github.com/user-attachments/assets/54912f37-0250-463e-b855-509f0c056c48" />

<img width="554" height="291" alt="image" src="https://github.com/user-attachments/assets/fbd4e1d2-88c3-4a5d-806b-9d01d237a781" />

占据栅格的高度范围为0.1-0.62

```Plain Text
roslaunch carter_2dnav carter_navigation.launch
```

- 多线激光雷达

<img width="553" height="242" alt="image" src="https://github.com/user-attachments/assets/ab1faf91-8336-4a60-8d9a-1b52bd0de9bf" />

Isaac/Samples/ROS/Scenario/rtx_lidar_carter_warehouse_navigation.usd

```Plain Text
roslaunch carter_2dnav carter_navigation_rtx.launch
```

###### ROS2

[https://docs.omniverse.nvidia.com/isaacsim/latest/ros_ros2_tutorials.html ](https://docs.omniverse.nvidia.com/isaacsim/latest/ros_ros2_tutorials.html )

官方 demo
[https://docs.omniverse.nvidia.com/isaacsim/latest/ros2_tutorials/tutorial_ros2_navigation.html](https://docs.omniverse.nvidia.com/isaacsim/latest/ros2_tutorials/tutorial_ros2_navigation.html)

**（1）加载模型**

         Isaac Examples -> ROS2 -> Navigation
		 
**（2）点击 PLAY 开始仿真**

**（3）运行 launch 文件**

```Shell
ros2 launch carter_navigation carter_navigation.launch.py
```

机器人初始位置配置在文件carter_navigation_params.yaml 中，如果机器人位置不正确，点击 rviz 中 的2D Pose Estimate 按钮给一个方向。

**（4）导航**

点击 rviz 中的 Navigation2 Goal 按钮，可以导航。

**（5）自动导航**


```Shell
ros2 launch isaac_ros_navigation_goal isaac_ros_navigation_goal.launch.py
```

其中 launch 的参数如下：
- goal_generator_type: 生成目标点的类型 RandomGoalGenerator 是随机生成； GoalReader 是用户自定义。
- map_yaml_path: 地图路径。默认 isaac_ros_navigation_goal/assets/carter_warehouse_navigation.yaml. 此时的目标点类型是 RandomGoalGenerator.
- iteration_count: 目标点被设置多少次.
- action_server_name: 执行服务器的名字.
- obstacle_search_distance_in_meters: 障碍物搜索距离.
- goal_text_file_path: 用户自定义的静态目标点。每一行都必须有一个单独的目标位姿，格式是pose.x pose.y orientation.x orientation.y orientation.z orientation.w. 参考文档在isaac_ros_navigation_goal/assets/goals.txt. 此时的目标点类型也必须是 GoalReader.
- initial_pose: 初始位姿 [pose.x, pose.y, pose.z, orientation.x, orientation.y, orientation.z, orientation.w].

**（6）注意的地方**

小车默认使用 RTX 雷达。
小车上大部分相机都屏蔽 publish 图片，可以去_camera_render_product 节点使能对应相机。

<img width="554" height="314" alt="image" src="https://github.com/user-attachments/assets/9cd756a3-05bf-4fe7-be82-044f20fa7f9d" />

<img width="553" height="124" alt="image" src="https://github.com/user-attachments/assets/a6d9335d-a2f7-4339-9f8b-fbe6c02b6936" />

设置 ROS_DOMAIN_ID 为 0 ，因为 isaac sim 默认是 0
模型导入、栅格地图生成

<img width="554" height="383" alt="image" src="https://github.com/user-attachments/assets/b81e8e9b-0bfa-4171-984f-df64cfb07f12" />

<img width="553" height="398" alt="image" src="https://github.com/user-attachments/assets/407389e5-9da7-4361-be7d-fac83a6b3077" />

<img width="554" height="423" alt="image" src="https://github.com/user-attachments/assets/7bb5d6c3-f5d9-4cd4-8cd1-b4daa2b7113d" />

模型导入之后，用 ariculation inspector 来观察是否导入正确。检查机器人行为是否符合预期。
如果发送速度控制，机器人会震荡，那么需要用 Gain tuner 来调整。首先要把重力去掉来调试。kp 和 kd 设置为 100 来试试等。具体参考视频教程的 b 站内容第一讲。

<img width="552" height="302" alt="image" src="https://github.com/user-attachments/assets/6de92b41-c837-438c-a8c7-4584bc61adb5" />

**加载一个环境**

<img width="553" height="420" alt="image" src="https://github.com/user-attachments/assets/3a578bc0-f502-4962-a01c-9e6f903dc18e" />

这需要网络下载，等待一下，选择最简单的 simple_warehouse 和 ware_extras

<img width="554" height="336" alt="image" src="https://github.com/user-attachments/assets/d68c63dd-b228-4598-bf5a-b07e1417e03f" />

<img width="553" height="565" alt="image" src="https://github.com/user-attachments/assets/aca04050-df9c-4c1a-830d-4de7ce07fd65" />

<img width="554" height="220" alt="image" src="https://github.com/user-attachments/assets/c5dd0551-4a92-4741-94d9-8a17e34ec32b" />

调整完，计算之后，点击可视化，保存 jpg 和 yaml。 

**激光雷达导入**

<img width="554" height="302" alt="image" src="https://github.com/user-attachments/assets/8f818691-5ea4-477b-b008-4fed00c53a50" />

<img width="554" height="799" alt="image" src="https://github.com/user-attachments/assets/c2ef501a-69f1-4add-aafd-85e8d808b96d" />

雷达是 PhysX Lidar

<img width="553" height="383" alt="image" src="https://github.com/user-attachments/assets/2ab9dc73-b9c0-41a2-961a-91d02e858a5a" />

<img width="553" height="383" alt="image" src="https://github.com/user-attachments/assets/1aa6ac84-829f-4cae-85e8-0c8c143ed904" />

把它拖上来

<img width="553" height="266" alt="image" src="https://github.com/user-attachments/assets/01b340a1-afb0-434a-ba26-c58c7242d385" />

<img width="554" height="302" alt="image" src="https://github.com/user-attachments/assets/ac70645f-e7a9-49b5-8490-24d1bd8192c9" />

<img width="554" height="309" alt="image" src="https://github.com/user-attachments/assets/cbd709e5-9a10-4607-92da-0dd3b3493577" />

这个 domian id 是跟你自己电脑设置的 bashrc 相关。如果没设置，就不用管它

**轮速订阅**

<img width="553" height="322" alt="image" src="https://github.com/user-attachments/assets/3ef21214-a568-4461-ae6f-575cec33a789" />

<img width="554" height="728" alt="image" src="https://github.com/user-attachments/assets/5247ca60-8aa0-4384-b890-db54c266b9c8" />

订阅节点输出的角速度和线速度都是 3 维向量，需要一个中间转化模块，输出一维值。
角速度输出的是 z 分量，线速度输出的是 x 分量。

<img width="554" height="279" alt="image" src="https://github.com/user-attachments/assets/4a9f34d0-8d65-4de4-96a2-d306965b05c8" />

把差速控制器连接给本体上的左右关节电机

<img width="554" height="385" alt="image" src="https://github.com/user-attachments/assets/474dbd11-bd17-40ed-9f7e-09b6a5e1f24b" />

constant token 组合两个关节名字，成为 array，发给 ariculation controller 中的 jointNames。array 是可以增加 input 的。
另外 twist 的输出要连接 controller 的输入。

<img width="554" height="225" alt="image" src="https://github.com/user-attachments/assets/f8885742-293c-4ed4-8da3-d3ad74b3ce28" />

每个 constant token 赋值两个 joint 名字
ros2 run rqt_robot_steering rqt_robot_steering
测试一下小车能不能跑

**添加 odom**

<img width="553" height="292" alt="image" src="https://github.com/user-attachments/assets/453f659a-cfa0-4eaa-b6e9-c9cda2f713fb" />

<img width="554" height="208" alt="image" src="https://github.com/user-attachments/assets/14e6f8ad-738b-4773-ba99-2d2b316d3d5e" />

记得把 timestamp 和 context 也连接上，图片中忘记加了。

添加 raw transform tree ，它表示的是 odom 到 base link。

transform tree 表示的是 base link 到 lidar camera imu 的逻辑。

<img width="553" height="319" alt="image" src="https://github.com/user-attachments/assets/1bbb6436-0fd8-498b-b4d1-56ccff6fc7b6" />

<img width="554" height="332" alt="image" src="https://github.com/user-attachments/assets/7ecc91ef-1215-4498-82fc-1978275891fb" />

运行后就会发布 odom 到 base link 的 tf。

添加 base link 本体的 tf。

<img width="553" height="474" alt="image" src="https://github.com/user-attachments/assets/2b159e56-3800-452c-98fc-46e503ca4638" />

ros2 run tf2_tools view_frames.py
<img width="552" height="148" alt="image" src="https://github.com/user-attachments/assets/aa7e30d6-056b-4f39-ac3b-04d499c64bde" />

```Shell
sudo apt install python3-rosinstall-generator python3-wstool build-essential python3-rosinstall python3-rosdep
```

**创建工作空间**

```Shell
cd /home/yab/.local/share/ov/pkg/isaac-sim-4.0.0
mkdir -p ros2_workspace/src
colcon build
source install/setup.bash
sudo apt install ros-foxy-pointcloud-to-laserscan
```

```Shell
rosdep install -i --from-path src --rosdistro foxy -y
```
代码在第 3 节的链接中

<img width="553" height="262" alt="image" src="https://github.com/user-attachments/assets/b24f27e8-6341-4e2a-90ba-b6dd3615c8e4" />


```Shell
ros2 launch carter_navigation carter_navigation.launch.py
```
有个报错

<img width="554" height="500" alt="image" src="https://github.com/user-attachments/assets/efa2ba2d-dfd0-45b7-ac07-5e3fb1ee39ad" />

先启动 isaac sim，再启动 launch 文件
一般重定位是没有的，所以需要自己手动发一个 2d pose
